<!DOCTYPE html>
<html ng-app="editorContent" ng-controller="MainController">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<base href="http://localhost:8080/">
		<title>RFB Editor</title>
		
		<link rel="stylesheet" href="css/bootstrap/css/bootstrap.css"/>
		<link rel="stylesheet" href="css/ng-grid.css"/>
		<link rel="stylesheet" href="js/bootstrap-window/css/bootstrap-window.css"/>
		
		<script src="js/jquery-1.11.1.js"></script>
		<script src="js/angular1.2.22.js"></script>

		<script src="rfb/angular/js/editor-content.js"></script>
		
		<!-- generate all component js --> 
		<script src="js/angular-webstorage.js"></script>
		<script src="js/angularui/ui-bootstrap-tpls-0.10.0.js"></script>
		<script src="js/angularui/ng-grid-2.0.7.debug.js"></script>
		<script src="js/numeral.js"></script>
		<script src="js/angular-file-upload/dist/angular-file-upload.min.js"></script>
		<script src="js/bootstrap-window/js/Window.js"></script>    <!-- TODO replace these with bootstrap-window.min.js --> 
		<script src="js/bootstrap-window/js/WindowManager.js"></script>	<!-- see ^ -->
		<script src="js/bindonce.js"></script>	
		
		<!-- base servoy libraries -->
		<link rel="stylesheet" href="css/servoy.css"/>
		<script src="js/servoy.js"></script>
		<script src="js/servoyWindowManager.js"></script>
		<script src="js/servoyformat.js"></script>
		<script src="js/servoytooltip.js"></script>
		<script src="js/fileupload.js"></script>
		<script src="js/servoy-components.js"></script>
		<script src="js/websocket.js"></script>
		<script src="js/servoy_app.js"></script>
		<script src="js/jquery.maskedinput.js"></script>

		
		<script>
			function getURLParameter(name) {
				return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null
			}
			var editorNode = parent.$(decodeURIComponent(getURLParameter('id')))
			
			function renderDecorators() {
				editorNode.trigger('renderDecorators.content')
			}

			$(document).ready(function(){
				editorNode.trigger('documentReady.content', document)

				/* 
				 * Attach scroll listeners on all elements to update decorators when scrolling
				 * Since scroll doesn't bubble, need to attach them directly on each element
				 * Using a MutationObserver to also hook up listener to newly inserted nodes
				 */
				//Attach to initial content
/* TODO is this needed this scrolling, if so then this should work the angular way because .sfcontent is not there yet.
				$('.svelement, .drag-scroll-preventer').on('scroll', function() { //CHECKME: is assignment to .svelement enough? What about other non-svelement scrollable nodes?
					renderDecorators()			
				})
				
				function attachScrollListeners(mutations) {
					for (var i = 0; i < mutations.length; i++) {
						var addedNodes = mutations[i].addedNodes
						for (var j = 0; j < addedNodes.length; j++) {
							$(addedNodes[j]).on('scroll', function() {
								renderDecorators()			
							})					
						}
					}
				}
				var newNodeObserver = new MutationObserver(attachScrollListeners);
				newNodeObserver.observe(document.querySelector('.sfcontent'), {
					subtree: true,
					childList: true
				});
*/			
			})
			$(window).resize(renderDecorators)
		</script>
		<style>
			/* Prevent scrollbars due to dragged element */
			body {
				overflow: hidden
			}
			/* Force rendering layer, so DND's are always on top'*/
			.sfcontent {
				position: relative;
				z-index: 1;
				/*background-image: url("rfb/angular/images/transparent.png")*/
			}
			
		</style>
		<link rel="stylesheet" ng-href='{{solutionSettings.styleSheetPath}}'/>
	</head>
	<body class="user-selection-off content">
		<div class="drag-scroll-preventer max" style="overflow: auto; z-index: 0">
			<!--Content-->
			<div class="sfcontent" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px;" ng-include="getUrl()">
			</div>
		</div>
	</body>
</html>
